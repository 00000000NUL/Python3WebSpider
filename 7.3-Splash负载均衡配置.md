## Nginx

```python
http {
	upstream splash {
		least_conn;
		server 42.159.27.223:8050;
		server 139.217.9.25:8050;
		server 42.159.27.9:8050;
		server 42.159.117.119:8050;
	}
	server {
		listen 8050;
		location / {
            proxy_pass http://splash;
        }
	}
}
```

```
sudo nginx -s reload
```


```python
http {
	upstream splash {
		least_conn;
		server 42.159.27.223:8050;
		server 139.217.9.25:8050;
		server 42.159.27.9:8050;
		server 42.159.117.119:8050;
	}
	server {
		listen 8050;
		location / {
            proxy_pass http://splash;
            auth_basic "Restricted";
            auth_basic_user_file /etc/nginx/conf.d/.htpasswd;
        }
	}
}
```


在这里使用的用户名密码配置放置在/etc/nginx/conf.d目录，我们需要使用htpasswd命令创建，例如创建一个用户名为admin的文件，命令如下：

```
htpasswd -c .htpasswd admin
```

接下就会提示我们输入密码，输入两次之后，就会生成密码文件，查看一下内容：

```
cat .htpasswd 
admin:5ZBxQr0rCqwbc
```

配置完成之后我们重启一下Nginx服务，运行如下命令：

```
sudo nginx -s reload
```

```python
import requests
from urllib.parse import quote
import re

lua = '''
function main(splash, args)
  local treat = require("treat")
  local response = splash:http_get("http://httpbin.org/get")
  return treat.as_string(response.body)
end
'''

url = 'http://211.159.152.173:8050/execute?lua_source=' + quote(lua)
response = requests.get(url, auth=('admin', 'admin'))
ip = re.search('(\d+\.\d+\.\d+\.\d+)', response.text).group(1)
print(ip)
```

```python
http_user = 'someuser'
http_pass = 'somepass'
```

