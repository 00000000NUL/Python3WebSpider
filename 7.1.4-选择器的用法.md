### Scrapy选择器用法

我们之前介绍了利用BeautifulSoup、PyQuery以及正则表达式来提取网页数据，但是在Scrapy中它也提供了自己的数据提取方法，即Selector（选择器），它是基于lxml来构建的，支持XPath选择器、CSS选择器以及正则表达式，功能全面，解析速度和准确度也是非常高的。

本节介绍一下Scrapy选择器的用法。

#### 直接使用

Scrapy Selector其实是一个可以独立使用的模块，我们可以直接利用这个类来构建一个选择器对象，然后调用它的相关方法如xpath()、css()等来提取数据。

比如有一段HTML代码，我们可以用如下方式构建Selector对象来提取数据，我们用一个实例来感受一下：

```python
from scrapy import Selector

body = '<html><head><title>Hello World</title></head><body></body></html>'
selector = Selector(text=body)
title = selector.xpath('//title/text()').extract_first()
print(title)
```

运行结果：

```
Hello World
```

我们在这里没有在Scrapy框架中运行，而是把Scrapy中的Selector单独拿出来使用了，构建的时候传入text这个参数，就生成了一个selector选择器对象，然后就可以像前面我们所用的Scrapy中的解析方式一样，调用xpath()、css()等方法来提取了。

在这里我们查找的是源代码中的title中的文本，通过在选择器最后加text()方法就可以实现文本的提取了。

以上就是Selector的直接使用方式，其实它也是同BeautifulSoup等库类似的强大的网页解析库，如果觉得方便的话，也可以在其他项目中直接使用Selector来提取数据。

接下来我们就用实例来详细讲解下Selector的用法。

#### Scrapy Shell

由于Selector主要是与Scrapy结合使用，例如Scrapy的回调函数中的参数response直接调用xpath()或者css()方法来提取数据，所以在这里我们借助于Scrapy Shell来模拟Scrapy请求的过程，拿到response对象，用它来讲解相关的提取方法。

在这里我们拿官方文档的一个样例页面来做演示。[http://doc.scrapy.org/en/latest/_static/selectors-sample1.html](http://doc.scrapy.org/en/latest/_static/selectors-sample1.html)

首先我们需要开启Scrapy Shell，在命令行下输入

```
scrapy shell http://doc.scrapy.org/en/latest/_static/selectors-sample1.html
```

这样我们就进入到了Scrapy Shell模式，这个过程其实是Scrapy为我们发起了一次请求，请求的链接就是刚才命令行下输入的链接，然后把一些可操作的变量传递给我们，如
request、response等等。

![](./assets/2017-05-02-19-39-25.jpg)

进入到Shell模式之后，我们可以在下方的输入命令调用对象的一些相关方法，回车之后会实时显示结果，这与Python的命令行交互模式是类似的。






