# MongoDB安装

MongoDB 是由C++语言编写的非关系型数据库，是一个基于分布式文件存储的开源数据库系统，其内容存储形式类似Json对象，它的字段值可以包含其他文档，数组及文档数组，非常灵活。

MongoDB支持多种平台，包括Windows、Linux、Mac OS、Solaris等，在其官方网站均可找到对应的安装包，[https://www.mongodb.com/download-center](https://www.mongodb.com/download-center)

本节我们来看下它的安装过程。

## 相关链接

* 官方网站：[https://www.mongodb.com](https://www.mongodb.com)
* 官方文档：[https://docs.mongodb.com](https://docs.mongodb.com)
* GitHub：[https://github.com/mongodb](https://github.com/mongodb)
* 中文教程：[http://www.runoob.com/mongodb/mongodb-tutorial.html](http://www.runoob.com/mongodb/mongodb-tutorial.html)

## Windows

直接在官网下载安装包即可，链接为：[https://www.mongodb.com/download-center#community](https://www.mongodb.com/download-center#community)，

![](./assets/2017-06-06-11-17-37.jpg)

直接点击Download下载msi安装包即可。

下载完成之后双击开始安装，指定MongoDB的安装路径，例如在此处我指定安装路径为C:\MongoDB\Server\3.4，当然路径可以自行选择。

![](./assets/2017-06-06-11-20-35.jpg)

点击下一步执行安装即可。

安装成功之后，进入MongoDB的安装目录，在此处所在路径是C:\MongoDB\Server\3.4，在bin目录下新建同级目录data，然后进入data文件夹新建子文件夹db，作为数据目录存储的文件夹。

![](./assets/2017-06-06-11-23-04.jpg)

![](./assets/2017-06-06-11-23-32.jpg)

之后打开命令行，进入MongoDB安装目录的bin目录下，运行MongoDB服务：

```
mongod --dbpath "C:\MongoDB\Server\3.4\data\db"
```

请记得将此处的路径替换成你的主机MongoDB安装路径。

运行之后会出现一些输出信息，如图所示：

![](./assets/2017-06-06-11-24-40.jpg)

这样我们就已经将MongoDB服务启动了。

但是这样如果我们想一直使用MongoDB就不能关闭此命令行，如果意外关闭或重启MongoDB服务就不能使用了，这显然不是我们想要的，所以接下来我们还需将MongoDB配置成系统服务。

首先我们要以管理员模式运行命令行，注意此处一定要是管理员模式运行，否则可能配置失败。

![](./assets/2017-06-06-11-53-29.jpg)

开始菜单搜索cmd，找到命令行，然后右键以管理员身份运行即可。

随后新建一个日志文件，在bin目录同级目录新建logs文件夹，进入之后新建一个mongodb.log文件，用于保存MongoDB运行的日志。

![](./assets/2017-06-06-11-35-27.jpg)

在命令行下输入如下内容：

```
mongod --bind_ip 0.0.0.0 --logpath "C:\MongoDB\Server\3.4\logs\mongodb.log" --logappend --dbpath "C:\MongoDB\Server\3.4\data\db" --port 27017 --serviceName "MongoDB" --serviceDisplayName "MongoDB" --install
```
这里的意思是绑定IP为0.0.0.0，即任意IP均可访问，指定日志路径、数据库路径、端口，指定服务名称，注意这里依然需要把路径替换成你的MongoDB安装路径，运行此命令后即可安装服务。

![](./assets/2017-06-06-11-41-36.jpg)

如果没有出现错误提示，则证明MongoDB服务已经安装成功。

![](./assets/2017-06-06-11-52-51.jpg)

可以在服务管理页面查看到系统服务，可以设置它的开机启动方式，如自动启动或手动启动等。这样我们就可以非常方便地管理MongoDB服务了。

启动服务之后我们在命令行下就可以利用mongo命令进入MongoDB命令交互环境了。

![](./assets/2017-06-06-12-04-51.jpg)

这样Windows下MongoDB配置就完成了。

## Linux

在这里以MongoDB 3.4为例说明MongoDB的安装过程。

### Ubuntu

首先导入MongoDB的GPG Key：

```
sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 0C49F3730359A14518585931BC711F9BA15703C6
```

随后创建apt-get源列表，各个系统版本对应的命令如下：

* Ubuntu 12.04

```
echo "deb [ arch=amd64 ] http://repo.mongodb.org/apt/ubuntu precise/mongodb-org/3.4 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-3.4.list
```

* Ubuntu 14.04

```
echo "deb [ arch=amd64 ] http://repo.mongodb.org/apt/ubuntu trusty/mongodb-org/3.4 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-3.4.list
```

* Ubuntu 16.04

```
echo "deb [ arch=amd64,arm64 ] http://repo.mongodb.org/apt/ubuntu xenial/mongodb-org/3.4 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-3.4.list
```

随后更新apt-get源：

```
sudo apt-get update
```

之后安装MongoDB即可：

```
sudo apt-get install -y mongodb-org
```

安装完成之后运行MongoDB，命令如下：

```
mongod --port 27017 --dbpath /data/db
```

运行命令之后MongoDB就在27017端口上运行了，数据文件会保存在/data/db路径下。

一般我们在Linux上配置MongoDB都是为了远程连接使用的，所以在这里还需要配置一下MongoDB的远程连接和用户名密码：

接着我们进入到MongoDB命令行：

```
mongo --port 27017
```

现在我们就已经进入到MongoDB的命令行交互模式下了，在此模式下运行如下命令：

```
> use admin
switched to db admin
> db.createUser({user: 'admin', pwd: 'admin123', roles: [{role: 'root', db: 'admin'}]})
Successfully added user: {
        "user" : "admin",
        "roles" : [
                {
                        "role" : "root",
                        "db" : "admin"
                }
        ]
}
```

这样我们就创建了一个用户名为admin，密码为admin123的用户，赋予最高权限。

随后需要修改MongoDB的配置文件，

执行如下命令：

```
sudo vi /etc/mongod.conf
```

修改net部分为：

```
net:
  port: 27017
  bindIp: 0.0.0.0
```

这样配置后MongoDB可被远程访问。

另外还需要添加如下权限认证配置，直接添加如下内容到配置文件：

```
security:
 authorization: enabled
```

配置完成之后我们需要重新启动MongoDB服务，命令如下：

```
sudo service mongod restart
```

这样远程连接和权限认证就配置完成了。

### CentOS、RedHat

首先添加MongoDB源：

```
sudo vi /etc/yum.repos.d/mongodb-org.repo
```

修改为如下内容保存：

```
[mongodb-org-3.4]
name=MongoDB Repository
baseurl=https://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/3.4/x86_64/
gpgcheck=1
enabled=1
gpgkey=https://www.mongodb.org/static/pgp/server-3.4.asc
```

然后执行yum命令安装：

```
sudo yum install mongodb-org
```

启动MongoDB服务：

```
sudo systemctl start mongod
```

停止和重新加载MongoDB服务：

```
sudo systemctl stop mongod
sudo systemctl reload mongod
```

有关远程连接和认证配置可以参考上文，方式是相同的。

更多Linux发行版的MongoDB安装方式可以参考官方文档：[https://docs.mongodb.com/manual/administration/install-on-linux/](https://docs.mongodb.com/manual/administration/install-on-linux/)。

## Mac

推荐使用Homebrew安装，执行brew命令即可：

```
brew install mongodb
```

然后创建一个新文件夹/data/db，用于存放MongoDB数据。

启动MongoDB服务：

```
brew services start mongodb
sudo mongod
```

这样就启动了MongoDB服务。

停止、重启MongoDB服务的命令：

```
brew services stop mongodb
brew services restart mongodb
```

## 可视化工具

在这里推荐一个可视化工具RoboMongo/Robo 3T，使用简单，功能强大，官方网站：[https://robomongo.org/](https://robomongo.org/)，三大平台都有支持，下载链接：[https://robomongo.org/download](https://robomongo.org/download)。

另外还有一个简单易用的可视化工具，Studio 3T，同样具有方便的图形化管理，官方网站：[https://studio3t.com](https://studio3t.com)，同样支持三大平台，下载链接：[https://studio3t.com/download/](https://studio3t.com/download/)。


